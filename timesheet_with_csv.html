<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Staff Timesheet - OneDrive Sync</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CLIENT_ID =  '37fbff84-e447-45f2-8f0c-dd7d523b8a28';
        
        // Auto-detect redirect URI
        const REDIRECT_URI = window.location.href.split('?')[0].split('#')[0];
        const TIMESHEET_FILENAME = 'staff-timesheet.json';
        
        console.log('Current Redirect URI:', REDIRECT_URI);
        console.log('Add this exact URI to your Azure App Registration under Authentication → Web → Redirect URIs');

        // MSAL Configuration
        const msalConfig = {
            auth: {
                clientId: CLIENT_ID,
                authority: 'https://login.microsoftonline.com/common',
                redirectUri: REDIRECT_URI
            },
            cache: {
                cacheLocation: 'localStorage',
                storeAuthStateInCookie: false
            }
        };

        const loginRequest = {
            scopes: ['User.Read', 'Files.ReadWrite']
        };

        let msalInstance = null;
        try {
            msalInstance = new msal.PublicClientApplication(msalConfig);
        } catch (error) {
            console.error('MSAL initialization error:', error);
        }

        function WeeklyTimesheet() {
            const [startDate, setStartDate] = useState('');
            const [activeTab, setActiveTab] = useState('timesheet');
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [userEmail, setUserEmail] = useState('');
            const [syncStatus, setSyncStatus] = useState('Not synced');
            const [isSyncing, setIsSyncing] = useState(false);
            const fileInputRef = useRef(null);
            const accessTokenRef = useRef(null);
            
            // Initialize timesheet data
            const [timesheetData, setTimesheetData] = useState(() => {
                const data = {};
                for (let i = 1; i <= 25; i++) {
                    data[`User ${i}`] = {
                        name: `User ${i}`,
                        Monday: { start: '', end: '', break: '' },
                        Tuesday: { start: '', end: '', break: '' },
                        Wednesday: { start: '', end: '', break: '' },
                        Thursday: { start: '', end: '', break: '' },
                        Friday: { start: '', end: '', break: '' },
                        Saturday: { start: '', end: '', break: '' },
                        Sunday: { start: '', end: '', break: '' }
                    };
                }
                return data;
            });

            // Check authentication on mount
            useEffect(() => {
                if (!msalInstance) return;
                
                msalInstance.handleRedirectPromise().then((response) => {
                    if (response) {
                        setIsAuthenticated(true);
                        setUserEmail(response.account.username);
                        accessTokenRef.current = response.accessToken;
                        loadFromOneDrive(response.accessToken);
                    } else {
                        const accounts = msalInstance.getAllAccounts();
                        if (accounts.length > 0) {
                            setIsAuthenticated(true);
                            setUserEmail(accounts[0].username);
                            acquireToken();
                        }
                    }
                }).catch((error) => {
                    console.error('Redirect error:', error);
                });
            }, []);

            // Auto-save to OneDrive when data changes
            useEffect(() => {
                if (isAuthenticated && accessTokenRef.current) {
                    const timer = setTimeout(() => {
                        saveToOneDrive();
                    }, 2000); // Debounce saves by 2 seconds
                    return () => clearTimeout(timer);
                }
            }, [timesheetData, startDate, isAuthenticated]);

            // Acquire access token
            const acquireToken = async () => {
                try {
                    const accounts = msalInstance.getAllAccounts();
                    if (accounts.length === 0) return;

                    const silentRequest = {
                        scopes: loginRequest.scopes,
                        account: accounts[0]
                    };

                    const response = await msalInstance.acquireTokenSilent(silentRequest);
                    accessTokenRef.current = response.accessToken;
                    loadFromOneDrive(response.accessToken);
                } catch (error) {
                    console.error('Silent token acquisition failed:', error);
                    msalInstance.acquireTokenRedirect(loginRequest);
                }
            };

            // Sign in with Microsoft
            const signIn = async () => {
                try {
                    await msalInstance.loginRedirect(loginRequest);
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed: ' + error.message);
                }
            };

            // Sign out
            const signOut = () => {
                const accounts = msalInstance.getAllAccounts();
                if (accounts.length > 0) {
                    msalInstance.logoutRedirect({
                        account: accounts[0]
                    });
                }
            };

            // Save to OneDrive
            const saveToOneDrive = async () => {
                if (!accessTokenRef.current) return;

                setIsSyncing(true);
                try {
                    const dataToSave = {
                        startDate,
                        timesheetData,
                        lastModified: new Date().toISOString()
                    };

                    const content = JSON.stringify(dataToSave, null, 2);
                    const blob = new Blob([content], { type: 'application/json' });

                    const uploadUrl = `https://graph.microsoft.com/v1.0/me/drive/root:/${TIMESHEET_FILENAME}:/content`;

                    const response = await fetch(uploadUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${accessTokenRef.current}`,
                            'Content-Type': 'application/json'
                        },
                        body: blob
                    });

                    if (response.ok) {
                        setSyncStatus('Synced to OneDrive ' + new Date().toLocaleTimeString());
                    } else {
                        const error = await response.json();
                        console.error('Save error:', error);
                        setSyncStatus('Sync failed');
                    }
                } catch (error) {
                    console.error('OneDrive save error:', error);
                    setSyncStatus('Sync error');
                } finally {
                    setIsSyncing(false);
                }
            };

            // Load from OneDrive
            const loadFromOneDrive = async (token) => {
                try {
                    const downloadUrl = `https://graph.microsoft.com/v1.0/me/drive/root:/${TIMESHEET_FILENAME}:/content`;

                    const response = await fetch(downloadUrl, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.startDate) setStartDate(data.startDate);
                        if (data.timesheetData) setTimesheetData(data.timesheetData);
                        setSyncStatus('Loaded from OneDrive');
                    } else if (response.status === 404) {
                        setSyncStatus('No saved data found - will create on first save');
                    }
                } catch (error) {
                    console.error('OneDrive load error:', error);
                    setSyncStatus('Load error');
                }
            };

            // Get dates for the week
            const getWeekDates = () => {
                if (!startDate) return {};
                const dates = {};
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                const start = new Date(startDate);
                
                days.forEach((day, index) => {
                    const date = new Date(start);
                    date.setDate(start.getDate() + index);
                    dates[day] = date.toLocaleDateString('en-AU', { day: '2-digit', month: '2-digit' });
                });
                
                return dates;
            };

            const weekDates = getWeekDates();

            // Calculate hours worked
            const calculateHours = (start, end, breakTime) => {
                if (!start || !end) return 0;
                
                const [startHour, startMin] = start.split(':').map(Number);
                const [endHour, endMin] = end.split(':').map(Number);
                
                let startMinutes = startHour * 60 + startMin;
                let endMinutes = endHour * 60 + endMin;
                
                if (endMinutes < startMinutes) {
                    endMinutes += 24 * 60;
                }
                
                const totalMinutes = endMinutes - startMinutes;
                const breakMinutes = parseFloat(breakTime || 0) * 60;
                
                return Math.max(0, (totalMinutes - breakMinutes) / 60);
            };

            // Update timesheet data
            const updateData = (user, day, field, value) => {
                setTimesheetData(prev => ({
                    ...prev,
                    [user]: {
                        ...prev[user],
                        [day]: {
                            ...prev[user][day],
                            [field]: value
                        }
                    }
                }));
            };

            // Update user name
            const updateUserName = (oldName, newName) => {
                if (!newName.trim()) return;
                
                setTimesheetData(prev => {
                    const newData = {};
                    Object.keys(prev).forEach(key => {
                        if (key === oldName) {
                            newData[newName] = {
                                ...prev[key],
                                name: newName
                            };
                        } else {
                            newData[key] = prev[key];
                        }
                    });
                    return newData;
                });
            };

            // Reset all data
            const resetTimesheet = () => {
                if (window.confirm('Are you sure you want to reset all timesheet data? This will also update OneDrive.')) {
                    const data = {};
                    for (let i = 1; i <= 25; i++) {
                        data[`User ${i}`] = {
                            name: `User ${i}`,
                            Monday: { start: '', end: '', break: '' },
                            Tuesday: { start: '', end: '', break: '' },
                            Wednesday: { start: '', end: '', break: '' },
                            Thursday: { start: '', end: '', break: '' },
                            Friday: { start: '', end: '', break: '' },
                            Saturday: { start: '', end: '', break: '' },
                            Sunday: { start: '', end: '', break: '' }
                        };
                    }
                    setTimesheetData(data);
                    setStartDate('');
                }
            };

            // Export weekly report with both timesheet and summary
            const exportWeeklyReport = () => {
                const weekStart = startDate || 'unspecified-date';
                const summary = getSummary();
                
                const report = {
                    weekStarting: startDate,
                    generatedDate: new Date().toISOString(),
                    timesheetData: timesheetData,
                    summary: {
                        staffHours: summary,
                        totals: {
                            totalHours: summary.reduce((sum, s) => sum + parseFloat(s.totalHours), 0).toFixed(2),
                            saturdayHours: summary.reduce((sum, s) => sum + parseFloat(s.saturdayHours), 0).toFixed(2),
                            sundayHours: summary.reduce((sum, s) => sum + parseFloat(s.sundayHours), 0).toFixed(2)
                        }
                    }
                };
                
                const json = JSON.stringify(report, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `weekly-report-${weekStart}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Export summary as CSV to OneDrive
            const exportSummaryCSV = async () => {
                if (!accessTokenRef.current) {
                    alert('Not connected to OneDrive. Please sign in first.');
                    return;
                }
                
                if (!startDate) {
                    alert('Please set a week starting date first.');
                    return;
                }
                
                setIsSyncing(true);
                setSyncStatus('Saving summary to OneDrive...');
                
                try {
                    const summary = getSummary();
                    
                    // Create CSV content
                    let csv = 'Staff Member,Total Hours,Saturday Hours,Sunday Hours\n';
                    summary.forEach(({ user, totalHours, saturdayHours, sundayHours }) => {
                        const displayName = timesheetData[user]?.name || user;
                        csv += `"${displayName}",${totalHours},${saturdayHours},${sundayHours}\n`;
                    });
                    
                    // Add totals row
                    const totals = {
                        total: summary.reduce((sum, s) => sum + parseFloat(s.totalHours), 0).toFixed(2),
                        saturday: summary.reduce((sum, s) => sum + parseFloat(s.saturdayHours), 0).toFixed(2),
                        sunday: summary.reduce((sum, s) => sum + parseFloat(s.sundayHours), 0).toFixed(2)
                    };
                    csv += `"TOTAL",${totals.total},${totals.saturday},${totals.sunday}\n`;
                    
                    // Create folder structure: Timesheets/YYYY-MM-DD/
                    const folderPath = `Timesheets/${startDate}`;
                    const fileName = `summary-${startDate}.csv`;
                    
                    // Ensure the folder exists
                    const folderUrl = `https://graph.microsoft.com/v1.0/me/drive/root:/${folderPath}`;
                    let folderCheck = await fetch(folderUrl, {
                        headers: {
                            'Authorization': `Bearer ${accessTokenRef.current}`
                        }
                    });
                    
                    // Create folder if it doesn't exist
                    if (folderCheck.status === 404) {
                        // Create Timesheets folder first
                        let timesheetsFolder = await fetch(`https://graph.microsoft.com/v1.0/me/drive/root:/Timesheets`, {
                            headers: {
                                'Authorization': `Bearer ${accessTokenRef.current}`
                            }
                        });
                        
                        if (timesheetsFolder.status === 404) {
                            await fetch(`https://graph.microsoft.com/v1.0/me/drive/root/children`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${accessTokenRef.current}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    name: 'Timesheets',
                                    folder: {},
                                    '@microsoft.graph.conflictBehavior': 'rename'
                                })
                            });
                        }
                        
                        // Create week folder
                        await fetch(`https://graph.microsoft.com/v1.0/me/drive/root:/Timesheets:/children`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${accessTokenRef.current}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: startDate,
                                folder: {},
                                '@microsoft.graph.conflictBehavior': 'rename'
                            })
                        });
                    }
                    
                    // Upload CSV file
                    const uploadUrl = `https://graph.microsoft.com/v1.0/me/drive/root:/${folderPath}/${fileName}:/content`;
                    const blob = new Blob([csv], { type: 'text/csv' });
                    
                    const uploadResponse = await fetch(uploadUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${accessTokenRef.current}`,
                            'Content-Type': 'text/csv'
                        },
                        body: blob
                    });
                    
                    if (uploadResponse.ok) {
                        setSyncStatus(`Summary saved to OneDrive/Timesheets/${startDate}/`);
                        alert(`✅ Summary saved to OneDrive!\n\nLocation: Timesheets/${startDate}/${fileName}`);
                    } else {
                        throw new Error('Upload failed');
                    }
                } catch (error) {
                    console.error('OneDrive CSV save error:', error);
                    setSyncStatus('CSV save failed');
                    alert('Failed to save summary to OneDrive. Please try again.');
                } finally {
                    setIsSyncing(false);
                }
            };

            // Download summary as CSV (local backup option)
            const downloadSummaryCSV = () => {
                const weekStart = startDate || 'unspecified-date';
                const summary = getSummary();
                
                let csv = 'Staff Member,Total Hours,Saturday Hours,Sunday Hours\n';
                summary.forEach(({ user, totalHours, saturdayHours, sundayHours }) => {
                    const displayName = timesheetData[user]?.name || user;
                    csv += `"${displayName}",${totalHours},${saturdayHours},${sundayHours}\n`;
                });
                
                // Add totals row
                const totals = {
                    total: summary.reduce((sum, s) => sum + parseFloat(s.totalHours), 0).toFixed(2),
                    saturday: summary.reduce((sum, s) => sum + parseFloat(s.saturdayHours), 0).toFixed(2),
                    sunday: summary.reduce((sum, s) => sum + parseFloat(s.sundayHours), 0).toFixed(2)
                };
                csv += `"TOTAL",${totals.total},${totals.saturday},${totals.sunday}\n`;
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `summary-${weekStart}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Export data to JSON file
            const exportData = () => {
                const dataToExport = {
                    startDate,
                    timesheetData
                };
                const json = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timesheet-${startDate || 'data'}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Import data from JSON file
            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (imported.startDate) setStartDate(imported.startDate);
                        if (imported.timesheetData) setTimesheetData(imported.timesheetData);
                        alert('Timesheet data imported successfully!');
                    } catch (error) {
                        alert('Error importing file. Please make sure it is a valid timesheet JSON file.');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            // Calculate summary data
            const getSummary = () => {
                const summary = [];
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                
                Object.keys(timesheetData).forEach(user => {
                    let totalHours = 0;
                    let saturdayHours = 0;
                    let sundayHours = 0;
                    
                    days.forEach(day => {
                        const { start, end, break: breakTime } = timesheetData[user][day];
                        const hours = calculateHours(start, end, breakTime);
                        totalHours += hours;
                        
                        if (day === 'Saturday') saturdayHours = hours;
                        if (day === 'Sunday') sundayHours = hours;
                    });
                    
                    summary.push({
                        user,
                        totalHours: totalHours.toFixed(2),
                        saturdayHours: saturdayHours.toFixed(2),
                        sundayHours: sundayHours.toFixed(2)
                    });
                });
                
                return summary;
            };

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

            // SVG Icons
            const CalendarIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            );

            const CloudIcon = () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                </svg>
            );

            const RotateCcwIcon = () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                </svg>
            );

            const DownloadIcon = () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            );

            const UploadIcon = () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
            );

            const LogOutIcon = () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
            );

            const FileTextIcon = () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            );

            // Show login screen if not authenticated
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
                        <div className="bg-white rounded-2xl shadow-xl p-12 max-w-md w-full text-center">
                            <div className="mb-6">
                                <CloudIcon />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-900 mb-4">
                                Weekly Staff Timesheet
                            </h1>
                            <p className="text-gray-600 mb-8">
                                Sign in with your Microsoft account to sync your timesheet data to OneDrive
                            </p>
                            {CLIENT_ID === 'YOUR_CLIENT_ID_HERE' ? (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                                    <p className="text-red-800 text-sm font-medium">
                                        ⚠️ Setup Required: Please configure your Azure App Client ID in the code
                                    </p>
                                </div>
                            ) : (
                                <button
                                    onClick={signIn}
                                    className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-3"
                                >
                                    <svg width="20" height="20" viewBox="0 0 23 23" fill="none">
                                        <path d="M11 11h11v11H11z" fill="#FEBA08"/>
                                        <path d="M0 11h11v11H0z" fill="#05A6F0"/>
                                        <path d="M11 0h11v11H11z" fill="#80BC06"/>
                                        <path d="M0 0h11v11H0z" fill="#F25325"/>
                                    </svg>
                                    Sign in with Microsoft
                                </button>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-900">Weekly Staff Timesheet</h1>
                                    <div className="flex items-center gap-2 mt-2 text-sm text-gray-600">
                                        <CloudIcon />
                                        <span>{userEmail}</span>
                                        <span className="mx-2">•</span>
                                        <span className={isSyncing ? 'text-blue-600 animate-pulse' : 'text-green-600'}>
                                            {isSyncing ? 'Syncing...' : syncStatus}
                                        </span>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportWeeklyReport}
                                        className="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors"
                                        title="Export complete weekly report with timesheet and summary"
                                    >
                                        <FileTextIcon />
                                        Weekly Report
                                    </button>
                                    <button
                                        onClick={exportData}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                                        title="Export timesheet data only"
                                    >
                                        <DownloadIcon />
                                        Export
                                    </button>
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                                    >
                                        <UploadIcon />
                                        Import
                                    </button>
                                    <button
                                        onClick={resetTimesheet}
                                        className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                                    >
                                        <RotateCcwIcon />
                                        Reset
                                    </button>
                                    <button
                                        onClick={signOut}
                                        className="flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                                    >
                                        <LogOutIcon />
                                        Sign Out
                                    </button>
                                </div>
                            </div>
                            
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".json"
                                onChange={importData}
                                className="hidden"
                            />
                            
                            <div className="flex items-center gap-4">
                                <CalendarIcon />
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Week Starting Date (Monday)
                                    </label>
                                    <input
                                        type="date"
                                        value={startDate}
                                        onChange={(e) => setStartDate(e.target.value)}
                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="bg-white rounded-lg shadow-sm mb-6">
                            <div className="flex border-b border-gray-200">
                                <button
                                    onClick={() => setActiveTab('timesheet')}
                                    className={`px-6 py-3 font-medium ${
                                        activeTab === 'timesheet'
                                            ? 'border-b-2 border-blue-500 text-blue-600'
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    Timesheet
                                </button>
                                <button
                                    onClick={() => setActiveTab('summary')}
                                    className={`px-6 py-3 font-medium ${
                                        activeTab === 'summary'
                                            ? 'border-b-2 border-blue-500 text-blue-600'
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    Summary
                                </button>
                            </div>
                        </div>

                        {/* Timesheet View */}
                        {activeTab === 'timesheet' && (
                            <div className="bg-white rounded-lg shadow-sm p-6 overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="border-b-2 border-gray-200">
                                            <th className="text-left py-3 px-2 font-semibold text-gray-700 sticky left-0 bg-white">
                                                Staff Member
                                            </th>
                                            {days.map(day => (
                                                <th key={day} className="py-3 px-2 font-semibold text-gray-700">
                                                    <div>{day}</div>
                                                    {weekDates[day] && (
                                                        <div className="text-xs font-normal text-gray-500">{weekDates[day]}</div>
                                                    )}
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.keys(timesheetData).map(user => (
                                            <tr key={user} className="border-b border-gray-100 hover:bg-gray-50">
                                                <td className="py-3 px-2 font-medium text-gray-900 sticky left-0 bg-white">
                                                    <input
                                                        type="text"
                                                        value={timesheetData[user]?.name || user}
                                                        onChange={(e) => {
                                                            const newName = e.target.value;
                                                            setTimesheetData(prev => ({
                                                                ...prev,
                                                                [user]: {
                                                                    ...prev[user],
                                                                    name: newName
                                                                }
                                                            }));
                                                        }}
                                                        onBlur={(e) => {
                                                            const newName = e.target.value.trim();
                                                            if (newName && newName !== user) {
                                                                updateUserName(user, newName);
                                                            }
                                                        }}
                                                        className="w-full px-2 py-1 text-sm border border-gray-200 rounded hover:border-blue-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                                                        placeholder="Enter name"
                                                    />
                                                </td>
                                                {days.map(day => (
                                                    <td key={`${user}-${day}`} className="py-3 px-2">
                                                        <div className="space-y-1">
                                                            <input
                                                                type="time"
                                                                value={timesheetData[user][day].start}
                                                                onChange={(e) => updateData(user, day, 'start', e.target.value)}
                                                                placeholder="Start"
                                                                className="w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent"
                                                            />
                                                            <input
                                                                type="time"
                                                                value={timesheetData[user][day].end}
                                                                onChange={(e) => updateData(user, day, 'end', e.target.value)}
                                                                placeholder="End"
                                                                className="w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent"
                                                            />
                                                            <input
                                                                type="number"
                                                                step="0.25"
                                                                min="0"
                                                                value={timesheetData[user][day].break}
                                                                onChange={(e) => updateData(user, day, 'break', e.target.value)}
                                                                placeholder="Break (hrs)"
                                                                className="w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent"
                                                            />
                                                            {timesheetData[user][day].start && timesheetData[user][day].end && (
                                                                <div className="text-xs font-medium text-gray-600 text-center">
                                                                    {calculateHours(
                                                                        timesheetData[user][day].start,
                                                                        timesheetData[user][day].end,
                                                                        timesheetData[user][day].break
                                                                    ).toFixed(2)}h
                                                                </div>
                                                            )}
                                                        </div>
                                                    </td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* Summary View */}
                        {activeTab === 'summary' && (
                            <div className="bg-white rounded-lg shadow-sm p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-900">Hours Summary</h2>
                                    <button
                                        onClick={exportSummaryCSV}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                                    >
                                        <DownloadIcon />
                                        Export CSV
                                    </button>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="border-b-2 border-gray-200">
                                                <th className="text-left py-3 px-4 font-semibold text-gray-700">Staff Member</th>
                                                <th className="text-right py-3 px-4 font-semibold text-gray-700">Total Hours</th>
                                                <th className="text-right py-3 px-4 font-semibold text-gray-700">Saturday Hours</th>
                                                <th className="text-right py-3 px-4 font-semibold text-gray-700">Sunday Hours</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {getSummary().map(({ user, totalHours, saturdayHours, sundayHours }) => (
                                                <tr key={user} className="border-b border-gray-100 hover:bg-gray-50">
                                                    <td className="py-3 px-4 font-medium text-gray-900">
                                                        {timesheetData[user]?.name || user}
                                                    </td>
                                                    <td className="py-3 px-4 text-right font-semibold text-gray-900">{totalHours}</td>
                                                    <td className="py-3 px-4 text-right text-gray-700">{saturdayHours}</td>
                                                    <td className="py-3 px-4 text-right text-gray-700">{sundayHours}</td>
                                                </tr>
                                            ))}
                                            <tr className="bg-gray-100 font-bold">
                                                <td className="py-4 px-4 text-gray-900">TOTAL</td>
                                                <td className="py-4 px-4 text-right text-gray-900">
                                                    {getSummary().reduce((sum, s) => sum + parseFloat(s.totalHours), 0).toFixed(2)}
                                                </td>
                                                <td className="py-4 px-4 text-right text-gray-900">
                                                    {getSummary().reduce((sum, s) => sum + parseFloat(s.saturdayHours), 0).toFixed(2)}
                                                </td>
                                                <td className="py-4 px-4 text-right text-gray-900">
                                                    {getSummary().reduce((sum, s) => sum + parseFloat(s.sundayHours), 0).toFixed(2)}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<WeeklyTimesheet />, document.getElementById('root'));
    </script>
</body>
</html>